== Requirement Class "Map Core"

=== Overview

[[maps-core-overview]]

include::requirements/requirements_class_core.adoc[]


This core specifies a map resource: a resource that represents the geospatial data as a rendered map. The map resource, as defined in this core retrieves a generic map as a graphical representation of the data in the API. The representation is not constrained almost any way by the client so the server is free to return a partial representation of an arbitrary size. Extensions to this core will add query parameters to personalize the server behavior to the client needs. Some of those extension will define specifying parameters that will determine the map resolution (width, height, bounding  box and CRS). In addition, another extension will define how a map endpoint can be retrieved as tiles by applying the OGC API - Tiles.

NOTE: There is no mandatory dependency of this core on OGC API - Commons. This allows for non-OGC APIs to implement this core without the need to comply to the OGC API common structure (landing page, conformance, API description). It expected that main implementations will specify the dependency on OGC API - Commons in the conformance page.

=== Declaration of conformance classes
To support "generic" clients that want to access multiple OGC API standards and extensions - and not "just" a specific API / server, the API has to declare the conformance classes it implements and conforms to.

==== Response
The conformance page mainly consists of a list of links.

include::requirements/core/REQ_conformance-success.adoc[]

If the server declares also conformity to OGC API - Common - Part 1: Core or to OGC API - Features - Part 1: Core, then it has to consider the OGC API requirements for declaring conformance, i.e. the use of a the conformance page. In the JSON format the conformance page is an array of links following the link schema defined in the OGC API - Common - Part 1: Core or in OGC API - Features - Part 1: Core. Below is an example fragment of a conformance information page of an API conformant to OGC API - Common and OGC API - Maps.

[[ConformancePageMapsCore]]
.Conformance Information Page fragment
=================
[source,JSON]
{
  "conformsTo": [
    "http://www.opengis.net/spec/ogcapi-common-1/1.0/conf/core",
    "http://www.opengis.net/spec/ogcapi-common-2/1.0/conf/collections",
    "http://www.opengis.net/spec/ogcapi-maps-1/1.0/conf/core"
  ]
}
=================

=== Map resource

A map distribution of a dataset is a pictorial representation of geospatial resources. To create a pictorial representation a style is added to the data in the geospatial resource.

This section defines the core resource of the OGC API - Maps standard  defines a map representation for a geospatial resources. To keep the core of the OGC API - Maps standard simple, the core only includes a mechanism to retrieve an arbitrary map.

==== Operation
include::requirements/core/REQ_map-op.adoc[]

include::recommendations/core/PER_map-op.adoc[]

==== Parameters transparent and bgcolor
These parameters indicate how the absence of data will be represented and allow for the map to be overlayed with others without completely cover the lower layers. The parameter `transparent` is deprecated and the use of the 'alpha channel' in `bgcolor` is recommended instead.

include::requirements/core/REQ_mc-transparent-definition.adoc[]

include::requirements/core/REQ_mc-bgcolor-definition.adoc[]

NOTE: If the client wants to force an opaque color, apart from defining the appropriate background color it should ensure that the parameter `transparent` is set to `false`. For the formats that reserve a color to define transparency, it still makes sense to combine background color and transparent=true with the purpose of helping the server to select a color that does not interfere with the actual values and colors in the map.

NOTE: The `opaque` and `cascaded` parameters present in the WMS have been deprecated and are not provided in this API.

==== Response
The response of a GET request to a map resource will be a map representing the data of the resource. The response could results in a map representing the whole geospatial data resource at maximum resolution that could be too difficult to generate by the server or too big to be efficiently retrieved by the client. It is expected that other query parameters are added by other extensions of this core to personalize the response.

include::requirements/core/REQ_map-response.adoc[]

== Requirement Class "Map Metadata"
=== Overview

[[maps-metadata-overview]]

include::requirements/requirements_class_core.adoc[]

This extension adds to the core the capability to retrieve a document that contains information (metadata) on the maps that can be useful and necessary to correctly formulate request of other extension such as the subset of a map. The document includes the CRSs and other styles supported and other metadata.

==== Map description document
The core introduces the way data will be combined with styles to create a styled map. The only mandatory element in the map description document is the list of styles that are used to transform a resource into a map.

==== Operation
include::requirements/metadata/REQ_md-op.adoc[]

==== Response
The response of a GET request to a map metadata resource will be a text documenIf it is not present we will assume there is no limit.t describing the map resource.

include::requirements/metadata/REQ_md-response.adoc[]

[#img_map-metadata-uml-model,reftext='{figure-caption} {counter:figure-num}']
.Map metadata UML model
image::images/MapMetadata.png[TileMatrixSet UML model]

[#parts-of-map-metadata-data-structure,reftext='{table-caption} {counter:table-num}']
.Parts of Map Metadata data structure
[width = "100%",options="header"]
|===
| Names | Definition | Data type and values | Multiplicity and use
| wgs84SpatialExtent | Minimum bounding rectangle surrounding the data available a map, in the WGS84 | WGS84BoundingBox data structure, see 2DTMS standard | Zero or one (optional)
| crsSpatialExtent | Minimum bounding rectangle surrounding the data available a map, in the indicated CRS | BoundingBox data structure, see 2DTMS standard | Zero or one (optional)
| minScaleDenominator | Minimum scale denominator (inclusive) for which it is appropriate to generate a map of this resource. Requests outside this interval will return an HTTP 404. | double | Zero or one (optional) If it is not present we will assume there is no scale lower limit.
| maxScaleDenominator | Maximum scale denominator (inclusive) for which it is appropriate to generate a map of this resource. Requests outside this interval will return an HTTP 404. | double | Zero or one (optional) If it is not present we will assume there is no scale upper limit.
| minCellSize | Maximum cell size (inclusive) for which it is appropriate to generate a map of this resource. Requests outside this interval will return an HTTP 404. | double | Zero or one (optional) If it is not present we will assume there is no cell size lower limit.
| maxCellSize | Maximum cell size (inclusive) for which it is appropriate to generate a map of this resource. Requests outside this interval will return an HTTP 404. | double | Zero or one (optional) If it is not present we will assume there is no cell size upper limit.
| recommendedFormat | Recommended output formats for a map request^a^ | MediaType | Zero or one (optional) Include when available and useful. It would be one of the supported for the map operation
| supportedFormat | Supported output formats for a map request | MediaType | Zero or more (optional) Include when available and useful.
| maxWidth | Maximum width values that a client is permitted to include in a map operation. | nonNegativeInteger  | Zero or one (optional). If absent the server imposes no limit
| maxHeight | Maximum height values that a client is permitted to include in a map operation. | nonNegativeInteger  | Zero or one (optional). If absent the server imposes no limit
| link | Links to related resources | WebLink data structure, see 2DTMS | Zero or more (optional)
4+|^a^    Depending of the nature of the data, a format might be better than another. Categorical data looks better in a PNG but continuous data and pictures are smaller a JPEG. The map operation details all available formats for the OGC API maps. In contrast, this is the better one for this type of information.
^e^     Possible link 'rel' values are: 'style' for a URL pointing to other styles of the resource exposed as maps, 'maps' for a URL template to the map resource. 'alternate' for a URL pointing to another representation of the MapMetadata (e.g a TileJSON file).
